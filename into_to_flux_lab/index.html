<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Meta, title, CSS, favicons, etc. -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="keywords" content="Wikismith">

    <title>
      Into to Flux - Lab
    </title>

    <!-- bower:css -->
    <link rel="stylesheet" href="/bs3/bower/css/bootstrap.css">
    <!-- endinject -->

    <!-- inject:css -->
    <link rel="stylesheet" href="/bs3/css/blog.css">
    <link rel="stylesheet" href="/bs3/css/docs.min.css">
    <link rel="stylesheet" href="/bs3/css/railscasts.css">
    <!-- endinject -->

    <!--[if lt IE 9]><script src="../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../assets/js/ie10-viewport-bug-workaround.js"></script>
    <script src="../assets/js/ie-emulation-modes-warning.js"></script>

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Favicons -->
    <link rel="apple-touch-icon-precomposed" href="/apple-touch-icon-precomposed.png">
    <link rel="icon" href="/favicon.ico">


</head>
<body>
<a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

<!-- Docs master nav -->
<header class="navbar navbar-static-top bs-docs-nav" id="top" role="banner">
    <div class="container">
        <div class="navbar-header">
            <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".bs-navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <a href="../../../" class="navbar-brand">
              <img src="http://www.gravatar.com/avatar/91f491389b01231140190aef863408c9.png">
              &nbsp;
              jrhicks.github.io
            </a>
        </div>
        <nav class="collapse navbar-collapse bs-navbar-collapse" role="navigation">
            <!--
            <ul class="nav navbar-nav">
                <li>
                    <a href="/interests.html">Interest</a>
                </li>
                <li>
                    <a href="/projects">Projects</a>
                </li>
                <li>
                    <a href="/about">Speaking</a>
                </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li><a href="http://blog.getbootstrap.com" onclick="ga('send', 'event', 'Navbar', 'Community links', 'Blog');">About</a></li>
            </ul>
            -->
        </nav>
    </div>
</header>



<!-- Docs page layout -->
<div class="bs-docs-header" id="content">
    <div class="container">
        <h1>Into to Flux - Lab</h1>
        <p></p>
    </div>
</div>

<div class="container bs-docs-container">

<div class="row">
<div class="col-md-9" role="main">


<div class="alert alert-success" role="alert">Want to help improve this article? <a href="https://github.com/jrhicks/jrhicks.github.source/edit/master/pages/into_to_flux_lab/index.md">Edit it</a></div>

<!-- h1 --><h1 class="page-header" id="md-objectives">Objectives</h1><ul>
<li><p>Understand Flux</p>
</li>
<li><p>Build TodoMVC using Flux</p>
</li>
</ul>
<!-- h1 --><h1 class="page-header" id="md-understand-flux">Understand Flux</h1><p>Facebook contends that modern MVC looks like this, I&#39;m not 100% sure how a web app&#39;s MVC looks like this, but if it did they say that the bi-directional updates create &quot;infinite loops&quot;.  Its difficult to trace in diagram, its even more difficult to trace in code.</p>
<!-- h2 --><h2 id="md-facebook-39-s-problem-with-client-side-mvc">Facebook&#39;s Problem With Client Side MVC</h2><p><img src="http://cdn.infoq.com/statics_s2_20151215-0056/resource/news/2014/05/facebook-mvc-flux/en/resources/flux-react-mvc.png" width="100%"></p>
<!-- h2 --><h2 id="md-server-side-mvc">Server side MVC</h2><p>As popularized by Rails.  Server side MVC is a scheme for separation of concerns / technologies as the we move from request to response.</p>
<p><img src="https://ihower.tw/rails4/images/basic-mvc-diagram.png" width="100%"></p>
<!-- h2 --><h2 id="md-mvc-1988">MVC 1988</h2><p>Original MVC from Smalltalk80.  1988</p>
<p><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/a/a0/MVC-Process.svg/500px-MVC-Process.svg.png" width="50%"></p>
<!-- h2 --><h2 id="md-flux-is-similar-to-mvc">Flux is similar to MVC</h2><p><img src="flux_mvc.png" width="100%"></p>
<!-- h2 --><h2 id="md-flux-basics">Flux basics</h2><ul>
<li><p>An Action - Is Just DATA.  Yes data.  It typically contains some unique name or title to identify it, and some data that supports it.  Its almost like a web request in the sense that web requests have an url to identify them and parameters / form data.  Actions (unlike web requests) are client side.</p>
</li>
<li><p>Dispatcher - The dispatcher is somewhat analogous to a web framework&#39;s router, except instead of invoking an entry point, it gives the action to EVERY SINGLE STORE in the app.  Every single store looks at the action and decides if and what it wants to do with the action.  Since the dispatcher takes care of giving all the stores the action, the views only need to dispatch the action and can be developed blissfully unaware of current or future stores.</p>
</li>
<li><p>Store - The store is analogous to a model, except a single store may hold a collection of records, multiple collections of records, a single record, or a summary of records.  Its to constraining to think of them like with the of Object Relation Mappers in rails.</p>
</li>
<li><p>View - Views are React components.  They listen to changes in certain stores and re-render themselves as needed from data in 1 or more stores.  React components can respond to user events by dispatching actions.</p>
</li>
</ul>
<!-- h1 --><h1 class="page-header" id="md-flux-original">Flux Original</h1><!-- h2 --><h2 id="md-actions">Actions</h2><ul>
<li><p>An action is data.</p>
</li>
<li><p>You write action creators.</p>
</li>
<li><p>Action creators create the data and send it the dispatcher.</p>
</li>
</ul>
<pre><code>var TodoActions = {

  updateText: function(<span class="hljs-property">id</span>, <span class="hljs-type">text</span>) {
    AppDispatcher.dispatch({
      actionType: TodoConstants.TODO_UPDATE_TEXT,
      <span class="hljs-property">id</span>: <span class="hljs-property">id</span>,
      <span class="hljs-type">text</span>: <span class="hljs-type">text</span>
    });
  },

  destroy: function(<span class="hljs-property">id</span>) {
  AppDispatcher.dispatch({
    actionType: TodoConstants.TODO_DESTROY,
    <span class="hljs-property">id</span>: <span class="hljs-property">id</span>
  });
}
</code></pre><!-- h2 --><h2 id="md-dispatcher">Dispatcher</h2><ul>
<li><p>Sends the action to all stores that have registered with it.</p>
</li>
<li><p>Only 1 dispatcher.</p>
</li>
</ul>
<!-- h2 --><h2 id="md-stores">Stores</h2><ul>
<li><p>Register with the dispatcher.</p>
</li>
<li><p>Inspect the action and decide whether and how to update its data.</p>
</li>
<li><p>Emit Change</p>
</li>
</ul>
<pre><code>AppDispatcher.register(function(action) {
  var <span class="hljs-built_in">text</span>;

  <span class="hljs-keyword">switch</span>(action.actionType) {
    <span class="hljs-keyword">case</span> TodoConstants.TODO_CREATE:
      <span class="hljs-built_in">text</span> = action.<span class="hljs-built_in">text</span>.<span class="hljs-built_in">trim</span>();
      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">text</span> !== <span class="hljs-string">''</span>) {
        create(<span class="hljs-built_in">text</span>);
        TodoStore.emitChange();
      }
      <span class="hljs-keyword">break</span>;

    <span class="hljs-keyword">case</span> TodoConstants.TODO_TOGGLE_COMPLETE_ALL:
      <span class="hljs-keyword">if</span> (TodoStore.areAllComplete()) {
        updateAll({complete: <span class="hljs-keyword">false</span>});
      } <span class="hljs-keyword">else</span> {
        updateAll({complete: <span class="hljs-keyword">true</span>});
      }
      TodoStore.emitChange();
      <span class="hljs-keyword">break</span>;
</code></pre><!-- h2 --><h2 id="md-view">View</h2><ul>
<li><p>These are React Components</p>
</li>
<li><p>Components can populate the default state fromt he store</p>
</li>
<li><p>When components mount, have them listen to emitted changes from the store</p>
</li>
<li><p>When components unmount, have them stop</p>
</li>
</ul>
<pre><code><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getTodoState</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-keyword">return</span> {
    allTodos: TodoStore.getAll(),
    areAllComplete: TodoStore.areAllComplete()
  };
}

<span class="hljs-keyword">var</span> TodoApp = React.createClass({

  getInitialState: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> getTodoState();
  },

  componentDidMount: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    TodoStore.addChangeListener(<span class="hljs-keyword">this</span>._onChange);
  },

  componentWillUnmount: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    TodoStore.removeChangeListener(<span class="hljs-keyword">this</span>._onChange);
  },

  <span class="hljs-comment">/**
   * Event handler for 'change' events coming from the TodoStore
   */</span>
  _onChange: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">this</span>.setState(getTodoState());
  }

  render: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">/* Ommitted */</span>
  }
</code></pre><!-- h1 --><h1 class="page-header" id="md-flux-ecosystem">Flux Ecosystem</h1><p>Flux is a convention not a library.  Even the dispatcher which is a library isn&#39;t that hard to re-write.</p>
<ul>
<li><p><a href="https://github.com/voronianski/flux-comparison">Flux Comparison</a></p>
</li>
<li><p><a href="/getting_started_with_flux_on_rails/index.html#md-adopting-a-flux-library">Adopting a Flux Library</a></p>
</li>
</ul>
<!-- h1 --><h1 class="page-header" id="md-build-todomvc-using-flux">Build TodoMVC using Flux</h1><ul>
<li><p>git clone <a href="https://github.com/arkency/react_flux_alt_immutable_todolist">https://github.com/arkency/react_flux_alt_immutable_todolist</a></p>
</li>
<li><p>cd flux_alt_immutable_todolist</p>
</li>
<li><p>grunt build</p>
</li>
<li><p>grunt serve</p>
</li>
</ul>
<!-- h2 --><h2 id="md-review-code-base">Review code base</h2><ul>
<li><p>Form responds to input</p>
</li>
<li><p>Todo items respond</p>
</li>
</ul>
<!-- h2 --><h2 id="md-clippy">Clippy</h2><p>Time magazine named Clippy one of the 50 worst inventions.  Sounds like a  good idea.</p>
<p><img src="http://img.timeinc.net/time/photoessays/2010/worst_inventions/worstinventions_clippy.jpg" width="20%"></p>
<pre><code><span class="hljs-keyword">import</span> ImmutableStore from <span class="hljs-string">'alt/utils/ImmutableUtil'</span>;
<span class="hljs-keyword">import</span> AltInstance    from <span class="hljs-string">'lib/AltInstance'</span>;
<span class="hljs-keyword">import</span> Actions        from <span class="hljs-string">'actions/TodoList'</span>;

<span class="hljs-keyword">class</span> ClippyStore {
  <span class="hljs-constructor"><span class="hljs-keyword">constructor</span>() </span>{
    <span class="hljs-keyword">let</span> { addTask, removeTask } = Actions;

    <span class="hljs-keyword">this</span>.bindListeners({
      add: addTask,
      remove: removeTask
    });

    <span class="hljs-keyword">this</span>.state = <span class="hljs-string">"Hello :)"</span>;
  }

  add(task) {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Got It! Task noted."</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.setState(<span class="hljs-string">"Got it!  Task noted."</span>);
  }

  remove(taskID) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.setState(<span class="hljs-string">"Awesome!"</span>);
  }
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> AltInstance.createStore(ImmutableStore(ClippyStore));
</code></pre><!-- h2 --><h2 id="md-clippy-view">Clippy View</h2><ul>
<li>Create class -vs- ES6 Classes</li>
</ul>
<pre><code><span class="hljs-keyword">import</span> <span class="hljs-type">React</span> from <span class="hljs-symbol">'react</span>/addons';
<span class="hljs-keyword">import</span> { <span class="hljs-type">Alert</span> } from <span class="hljs-symbol">'react</span>-bootstrap';
<span class="hljs-keyword">import</span> <span class="hljs-type">ClippyStore</span> from <span class="hljs-symbol">'stores</span>/<span class="hljs-type">Clippy</span>';

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Clippy</span> <span class="hljs-keyword"><span class="hljs-keyword">extends</span></span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span> {</span>
  constructor(props) {
    <span class="hljs-keyword">super</span>(props);

    <span class="hljs-keyword">this</span>.state = { message: <span class="hljs-type">ClippyStore</span>.getState() };
    <span class="hljs-keyword">this</span>.onChange = <span class="hljs-keyword">this</span>.onChange.bind(<span class="hljs-keyword">this</span>);
  }

  componentDidMount()    { <span class="hljs-type">ClippyStore</span>.listen(<span class="hljs-keyword">this</span>.onChange); }
  componentWillUnmount() { <span class="hljs-type">ClippyStore</span>.unlisten(<span class="hljs-keyword">this</span>.onChange); }

  onChange()  { <span class="hljs-keyword">this</span>.setState({ message: <span class="hljs-type">ClippyStore</span>.getState() }); }

  render() {
    <span class="hljs-keyword">return</span> (
      &lt;<span class="hljs-type">Alert</span>&gt; {<span class="hljs-keyword">this</span>.state.message} &lt;/<span class="hljs-type">Alert</span>&gt;
    );
  }
}

export <span class="hljs-keyword">default</span> <span class="hljs-type">Clippy</span>;
</code></pre><!-- end -->
<hr>

<a href="https://twitter.com/share" class="twitter-share-button" data-via="jrhicks">Tweet</a>

<a href="https://twitter.com/jrhicks">Follow Jeffrey Hicks on Twitter</a></a>
<hr>
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'jrhicksgithubio';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>


</div>

<div class="col-md-3">
    <div class="bs-docs-sidebar hidden-print hidden-xs hidden-sm" role="complementary">

        <ul class="nav bs-docs-sidenav">
            
            
            
            <li><a href="#md-objectives">Objectives</a></li>
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
            <li><a href="#md-understand-flux">Understand Flux</a></li>
            
          
            
            
          
            
            
          
          <li style="margin-left: 0.5em;"><a href="#md-facebook-s-problem-with-client-side-mvc">Facebook&#39;s Problem With Client Side MVC</a></li>
          
            
            
          
            
            
          
          <li style="margin-left: 0.5em;"><a href="#md-server-side-mvc">Server side MVC</a></li>
          
            
            
          
            
            
          
            
            
          
          <li style="margin-left: 0.5em;"><a href="#md-mvc-1988">MVC 1988</a></li>
          
            
            
          
            
            
          
            
            
          
          <li style="margin-left: 0.5em;"><a href="#md-flux-is-similar-to-mvc">Flux is similar to MVC</a></li>
          
            
            
          
            
            
          
          <li style="margin-left: 0.5em;"><a href="#md-flux-basics">Flux basics</a></li>
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
            <li><a href="#md-flux-original">Flux Original</a></li>
            
          
            
            
          
          <li style="margin-left: 0.5em;"><a href="#md-actions">Actions</a></li>
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
          <li style="margin-left: 0.5em;"><a href="#md-dispatcher">Dispatcher</a></li>
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
          <li style="margin-left: 0.5em;"><a href="#md-stores">Stores</a></li>
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
          <li style="margin-left: 0.5em;"><a href="#md-view">View</a></li>
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
            <li><a href="#md-flux-ecosystem">Flux Ecosystem</a></li>
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
            <li><a href="#md-build-todomvc-using-flux">Build TodoMVC using Flux</a></li>
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
          <li style="margin-left: 0.5em;"><a href="#md-review-code-base">Review code base</a></li>
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
          <li style="margin-left: 0.5em;"><a href="#md-clippy">Clippy</a></li>
          
            
            
          
            
            
          
            
            
          
            
            
          
          <li style="margin-left: 0.5em;"><a href="#md-clippy-view">Clippy View</a></li>
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
        </ul>


    </div>
</div>
</div>
</div>

<!-- Footer
================================================== -->
<footer class="bs-docs-footer" role="contentinfo">
    <div class="container">
        <p>Generated with <a href="http://wikismith.com">Wikismith</a> - <a href="http://getbootstrap.com">Bootstrap 3</a> Theme
    </div>
</footer>

<!-- bower:js -->
<script src="/bs3/bower/js/jquery.js"></script>
<script src="/bs3/bower/js/bootstrap.js"></script>
<!-- endinject -->

<!-- inject:js -->
<script src="/bs3/js/docs.min.js"></script>
<!-- endinject -->


<!-- TWITTER Put this just before the closing body tag -->
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
</body>
</html>
